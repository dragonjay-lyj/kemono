---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import { UserHeaderCard } from '../components/UserHeaderCard';
import { SearchBar } from '../components/SearchBar';
import { CustomPagination } from '../components/Pagination';
import { Link, Button } from '@heroui/react';

const allAuthors = await getCollection('authors');
const authorsPerPage = 9;
const currentPage = +(Astro.url.searchParams.get('page') || '1');
const shuffledAuthors = allAuthors.sort(() => Math.random() - 0.5);

const handlePageChange = (page: number) => {
  const url = new URL(Astro.url);
  url.searchParams.set('page', page.toString());
  window.location.href = url.toString();
};
---

<Layout 
  title="Featured Authors"
  description="Discover amazing content creators and their stories"
>
  <main class="min-h-screen bg-gradient-to-b from-background to-background/95">
    <!-- Hero Section -->
    <div class="
      relative 
      py-16 sm:py-24 
      overflow-hidden
      bg-gradient-to-b from-primary-500/10 to-transparent
    ">
      <div class="absolute inset-0 bg-grid-pattern opacity-5"></div>
      
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center space-y-6 animate-fade-in">
          <h1 class="
            text-4xl sm:text-5xl lg:text-6xl
            font-extrabold
            text-transparent bg-clip-text bg-gradient-to-r 
            from-primary-500 to-secondary-500
            tracking-tight
          ">
            kemono
          </h1>
          
          <p class="
            max-w-2xl 
            mx-auto 
            text-lg sm:text-xl 
            text-default-600
            dark:text-default-400
          ">
            å‘ç°æƒŠäººçš„å†…å®¹åˆ›ä½œè€…å’Œä»–ä»¬ç‹¬ç‰¹çš„è§‚ç‚¹
          </p>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <!-- Search and Stats -->
      <div class="
        flex flex-col sm:flex-row 
        items-center 
        justify-between 
        gap-4 
        mb-12
        animate-slide-up
      ">
        <div class="w-full sm:w-96">
          <SearchBar 
            client:visible 
            placeholder="Search authors..."
          />
        </div>
        
        <div class="text-sm text-default-600 dark:text-default-400">
          å±•ç¤º {shuffledAuthors.length} ä½œè€…
        </div>
      </div>

      <!-- Authors Grid -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8">
        {shuffledAuthors
          .slice((currentPage - 1) * authorsPerPage, currentPage * authorsPerPage)
          .map((author, index) => (
            <a 
              href={`/author/${author.id.replace('.mdx', '')}`}
              class="
                block
                transform 
                transition-all duration-300 
                hover:-translate-y-1 
                hover:shadow-lg
                rounded-xl
                animate-fade-in
                focus:outline-none
                focus:ring-2
                focus:ring-primary-500
                focus:ring-offset-2
              "
              style={`animation-delay: ${index * 100}ms`}
            >
              <UserHeaderCard
                client:visible
                {...author.data}
                isPreview={true}
              />
            </a>
          ))
        }
      </div>
      

      <!-- Empty State -->
      {shuffledAuthors.length === 0 && (
        <div class="
          text-center 
          py-16
          animate-fade-in
        ">
          <div class="text-6xl mb-4">ğŸ¤”</div>
          <h3 class="text-xl font-semibold mb-2">No authors found</h3>
          <p class="text-default-600 dark:text-default-400 mb-8">
            Try adjusting your search criteria
          </p>
          <Button
            color="primary"
            variant="flat"
            size="lg"
            onClick={() => window.location.reload()}
          >
            Reset Search
          </Button>
        </div>
      )}

      <!-- Pagination -->
      {shuffledAuthors.length > authorsPerPage && (
        <div class="
          mt-12 
          pt-8 
          border-t 
          border-default-200 
          dark:border-default-800
          animate-fade-in
        ">
          <CustomPagination
            client:visible
            total={Math.ceil(allAuthors.length / authorsPerPage)}
            page={currentPage}
            onChange={handlePageChange}
          />
        </div>
      )}
    </div>
  </main>
</Layout>

<style>
  .bg-grid-pattern {
    background-image: 
      linear-gradient(to right, rgba(99, 102, 241, 0.1) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(99, 102, 241, 0.1) 1px, transparent 1px);
    background-size: 24px 24px;
  }

  .animate-fade-in {
    animation: fadeIn 0.5s ease-out forwards;
  }

  .animate-slide-up {
    animation: slideUp 0.5s ease-out forwards;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
